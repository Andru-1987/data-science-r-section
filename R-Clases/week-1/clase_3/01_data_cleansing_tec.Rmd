# Data Cleansing Techniques in R
Que vamos a realizar en este sector? 
- Aprenderemos un poco sobre como limpiamos datos dentro de un dataframe para su proximo 
- Ordernaremos datos
- Graficaremos de manera eficiente los datos nulls, para evaluar la nullidad de manera visual

## 1. Limpieza de datos (Data Cleaning)

### Handling missing values
```{R , include=FALSE}
library(utils)

csv_uri <- "https://gist.githubusercontent.com/Andru-1987/d1a4296d140d8678dfb78acad47963e7/raw/83f3c954388a9b9f0e332c27fa3ccaead464c98b/dataset_to_clean.csv"
df <- read.csv(csv_uri)

# Check for missing values
sum(is.na(df))
colSums(is.na(df))


column <- "Year"
# Remove rows with any NA values
df_clean <- na.omit(df)

freq_table <- table(df[[column]])
barplot(
  freq_table,
  main="Frecuencia de valores unicos de Year",
  xlab="Year",
  ylab="Q",
  col="skyblue",
  border="gray"
)

text(x = 1:length(freq_table), y=freq_table/2, labels=freq_table, pos=3)

# Replace NA with mean/mode
df[[column]][is.na(df[[column]])] <- mean(df[[column]], na.rm = TRUE)

freq_table <- table(df[[column]])

barplot(
  freq_table,
  main="Frecuencia de valores unicos de Year",
  xlab="Year",
  ylab="Q",
  col="skyblue",
  border="gray"
)

text(x = 1:length(freq_table), y=freq_table/2, labels=freq_table, pos=3)

```

### Removing duplicates
```{R}
df_unique <- unique(df)

str(df_unique)
```

### Outlier detection and treatment
```{R}
# Identify outliers with boxplot stats
outliers <- boxplot.stats(df$numeric_column)$out
df_clean <- df[!df$numeric_column %in% outliers, ]

# Winsorizing outliers
library(DescTools)
df$column <- Winsorize(df$column, probs = c(0.05, 0.95))
```

## 2. Formateado de texto (Text Formatting)

### Case conversion
```{R}

if(! "wordcloud" %in% installed.packages()[,"Package"]){
  install.packages("wordcloud")
}

library(wordcloud)

df$Country <- tolower(df$Country)
df$Country <- toupper(df$Country)
df$Country <- tools::toTitleCase(df$Country)

head(df$Country)

# Cargar las librerías
library(wordcloud)
library(tm)
library(dplyr)

# Crear datos de ejemplo
ciudades <- unique(df$Country) 

# Contar frecuencias
freq_cuidades <- table(df$Country)

freq_ciudades

# # Crear nube de palabras básica
wordcloud(names(freq_palabras), freq_palabras, 
          min.freq = 1,
          # scale = c(3, 0.5),
          colors = brewer.pal(8, "Dark2"),
          random.order = FALSE,
          rot.per = 0.35)

```

### Removing special characters
```{R}
df$Country <- gsub("[^[:alnum:][:space:]]", "", df$Country)

glimpse(df)
```

### Standardizing formats
```{R}
# Dates
fecha_random <- sample(seq(as.Date("2020-01-01"), Sys.Date(), by= "day"), nrow(df),replace = TRUE)

df$fecha_registro <- format(fecha_random, "%m/%d/%Y")
df$fecha_registro <- as.Date(df$fecha_registro, format = "%m/%d/%Y")

# Numbers
# df$numeric_column <- format(round(df$numeric_column, 2), nsmall = 2)
glimpse(df)
```

## 3. Mapeado de datos categóricos (Categorical Data Mapping)

```{R}
# Create a mapping
category_map <- c("low" = 1, "medium" = 2, "high" = 3)

# Apply mapping
df$mapped_column <- category_map[df$category_column]
```

## 4. Label Encoding

```{R}
# Using factor conversion
df$encoded_column <- as.numeric(factor(df$category_column))

# Using match with unique values
df$encoded_column <- match(df$category_column, unique(df$category_column))
```

## 5. Dummy Encoding (One-Hot Encoding)

```{R}
# Using model.matrix
dummy_vars <- model.matrix(~category_column - 1, data = df)
df <- cbind(df, dummy_vars)

# Using dummies package
library(dummies)
df <- dummy.data.frame(df, names = c("category_column"), sep = "_")

# Using tidyverse
library(tidyverse)
df <- df %>% mutate(value = 1) %>% 
  pivot_wider(names_from = category_column, values_from = value, values_fill = 0)
```

## 6. String Operations

### Trimming whitespace
```{R}
df$Country <- trimws(df$Country)
```

### Splitting strings
```{R}
# Split into multiple columns
df <- separate(df, Country, into = c("part1", "part2"), sep = ",")

# Split into list
split_strings <- strsplit(df$Country, ",")
```

### String replacement
```{R}
df$Country <- gsub("old_text", "new_text", df$Country)
```

### Extracting patterns
```{R}
library(stringr)
df$extracted <- str_extract(df$Country, "[0-9]+") # extract numbers
```

### String length
```{R}
df$length <- nchar(df$Country)
```

### Concatenation
```{R}
df$combined <- paste(df$col1, df$col2, sep = "-")
```

## Additional Useful Techniques

### Consistent factor levels
```{R}
df$factor_column <- factor(df$factor_column, levels = c("level1", "level2", "level3"))
```

### Converting data types
```{R}
df$numeric_column <- as.numeric(df$character_column)
df$character_column <- as.character(df$numeric_column)
```

### Standardizing text (e.g., phone numbers)
```{R}
library(stringr)
df$phone <- str_replace_all(df$phone, "[^0-9]", "")
```