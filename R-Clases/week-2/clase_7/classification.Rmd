## Clasificacion -> Transformando un modelo presuntamente de Regression a uno de Clasificacion MultiClass

### 1. Crear categorías a partir de `charges`

Podemos usar `cut()` para dividir `charges` en 4 categorías, por ejemplo: *bajo*, *medio*, *alto*, *muy alto*.

```{R install, include=FALSE}
packages <- c("tidymodels", "ggplot2", "dplyr","glmnet", "ranger", "xgboost")
install.packages(setdiff(packages, rownames(installed.packages())))
```

```{R import-libraries}
library(tidymodels)
```

```{R load-dataset}
df <- read.csv("https://raw.githubusercontent.com/datasciencedojo/datasets/master/medical_cost.csv")

glimpse(df)
summary(df)

```


```{R}
df <- df %>%
  mutate(charges_cat = cut(charges,
                           breaks = quantile(charges, probs = seq(0, 1, 0.25)),
                           include.lowest = TRUE,
                           labels = c("bajo", "medio", "alto", "muy alto")))
```

### 2. Confirmar distribución

```{R}
table(df$charges_cat)
```

### 3. Preparar datos para clasificación

```{R}
set.seed(123)
split <- initial_split(df, prop = 0.8, strata = charges_cat)  # acá ya estratificamos por categoría
train_data <- training(split)
test_data <- testing(split)
```

### 4. Crear receta (preprocesamiento)

```{R}
car_recipe <- recipe(charges_cat ~ age + sex + bmi + children + smoker + region, data = train_data) %>%
  step_normalize(all_numeric_predictors()) %>%
  step_dummy(all_nominal_predictors())  # convierte factores a variables dummy
```

### 5. Definir modelo de clasificación

Por ejemplo, un random forest para clasificación:

```{R}
library(parsnip)

rf_model <- rand_forest(trees = 500) %>%
  set_engine("ranger") %>%
  set_mode("classification")
```

### 6. Crear workflow y entrenar

```{R}
library(workflows)

rf_wf <- workflow() %>%
  add_recipe(car_recipe) %>%
  add_model(rf_model)

rf_fit <- rf_wf %>%
  fit(data = train_data)
```

### 7. Evaluar el modelo

```{R}
library(yardstick)

predictions <- predict(rf_fit, test_data, type = "prob") %>%
  bind_cols(predict(rf_fit, test_data)) %>%
  bind_cols(test_data %>% select(charges_cat))

# Matriz de confusión
conf_mat(data = predictions, truth = charges_cat, estimate = .pred_class)

# Métricas de clasificación (accuracy, recall, precision)
metrics(data = predictions, truth = charges_cat, estimate = .pred_class)
```

---

### Resumen

* Transformás `charges` continua a variable categórica con `cut()` y quantiles.
* Hacés split estratificado por esa nueva variable.
* Preprocesás normalizando y dummificando variables categóricas.
* Elegís un modelo para clasificación (random forest, SVM, logistic regression multinomial, etc).
* Entrenás, predecís y evaluás con métricas de clasificación.

