---
title: "Miniâ€‘proyecto en R: ETLÂ â•Â EDAÂ (avanzada)Â â•Â Tests de HipÃ³tesis ğŸ§©ğŸ“Š"
output: html_notebook
---

> **Objetivo del notebook**  
> 1. Demostrar cÃ³mo hacer un flujo **ETL** rÃ¡pido sobre un dataset pÃºblico.  
> 2. Realizar un **EDA (AnÃ¡lisis Exploratorio de Datos)** mÃ¡s completo, incorporando `str()` y medidas de agregaciÃ³n.  
> 3. Explicar **quÃ© es un test de hipÃ³tesis** y mostrar ejemplos prÃ¡cticos (usando datos simulados y el *iris*).  


```{r setup, include=FALSE}
# ğŸ”§ Cargamos librerÃ­as clave 
suppressPackageStartupMessages({
  library(tidyverse)   # dplyr, ggplot2, readrâ€¦
  library(DT)          # tablas interactivas
  library(plotly)      # grÃ¡ficos interactivos
  library(corrplot)    # mapa de correlaciones
})

set.seed(42)           # reproducibilidad global
```

---
# 0ï¸âƒ£Â Conceptos rÃ¡pidos
| Concepto | Â¿QuÃ© es? | Â¿Por quÃ© lo usamos? |
|----------|----------|---------------------|
| **ETL**  | Extraerâ€‘Transformarâ€‘Cargar | Para dejar los datos limpios y listos para anÃ¡lisis o modelado. |
| **EDA**  | Exploratory Data Analysis | Paso de â€œcuriosearâ€ los datos: distribuciÃ³n, correlaciones, valores atÃ­picosâ€¦ |
| **Test de hipÃ³tesis** | Procedimiento estadÃ­stico que usa una muestra para decidir si cierta afirmaciÃ³n (*hipÃ³tesis nula*Â Hâ‚€) sobre la poblaciÃ³n es razonable o debe rechazarse en favor de una alternativa (Hâ‚). | Nos ayuda a convertir evidencia muestral en conclusiones: â€œÂ¿hay diferencia?â€, â€œÂ¿hay relaciÃ³n?â€, etc. |

> **Regla mental**: *Si el pâ€‘value < Î± (0.05) â‡’ rechazamos Hâ‚€.*  De lo contrario, no hay evidencia suficiente para descartarla.

---
# 1ï¸âƒ£Â ETL exprÃ©s con `iris` ğŸŒ¸

## 1.1Â Extract *(E)*
```{r etl-extract}
# Cargamos dataset que ya viene en R
data(iris)
iris_raw <- iris
iris_raw
```

## 1.2Â Transform *(T)*
```{r etl-transform}
iris_clean <- iris_raw %>%
  rename_with(~ str_replace_all(., "[.]", "_")) %>%       # ğŸ”¤ renombra: puntos â†’ guiÃ³n bajo
  # Cambiamos el nombre de la columna directamente ğŸ‘‰ evita duplicados
  rename(Petalo_Largo_cm = Petal_Length) %>%                  # alias descriptivo (cm)
  # mutate() crea la nueva variable de interÃ©s sin borrar ninguna otra
  mutate(Sepalo_Ratio = Sepal_Length / Sepal_Width)
iris_clean
```

### 1.2.1Â Ejercicios extra âœï¸
*Ejecuta uno a la vez y observa el cambio con `glimpse()`.*

```{r etl-extras}

# 3) Crear nuevas variables booleanas y factorizaciÃ³n
c <- iris_clean %>%
  mutate(Es_Petalo_Grande = Petalo_Largo_cm > 5) %>%        # TRUE/FALSE
  mutate(Species = factor(Species,                       # reordenamos niveles
                          levels = c("setosa", "versicolor", "virginica"),
                          labels = c("Setosa", "Versicolor", "Virginica")))

# Mostramos estructura de una versiÃ³n
c
```

> **Sugerencia**: experimenta combinando `rename_with()` con funciones de `stringr` (`str_replace`, `str_to_title`, etc.) para crear estilos coherentes de nombres de columna.

## 1.3Â Load *(L)*
```{r etl-load, include=FALSE}
write_csv(iris_clean, "iris_clean.csv")
```
---
# 2ï¸âƒ£Â EDA esencial ğŸ”

## 2.1Â InspecciÃ³n rÃ¡pida con `str()` y `glimpse()`
```{r str-glimpse}
str(iris_clean)      # estructura base R (tipo, longitud, etc.)

glimpse(iris_clean)  # alternativa tidyverse, mÃ¡s compacta
```

## 2.2Â Primeras estadÃ­sticas
```{r head-summary}
head(iris_clean, 5)                    # primeras filas
dplyr::count(iris_clean, Species)      # recuento por especie
summary(iris_clean)                    # resumen numÃ©rico
```

## 2.3Â Medidas de agregaciÃ³n por especie
```{r aggregation}
agg_tbl <- iris_clean %>% 
  group_by(Species) %>% 
  summarise(
    across(c(Sepal_Length, Sepal_Width, Petalo_Largo_cm, Sepalo_Ratio),
           list(media = mean, sd = sd, min = min, max = max))
  )

agg_tbl
```
*Â¿QuÃ© vemos?*  
Las medias y desviaciones estÃ¡ndar muestran que *virginica* tiende a tener pÃ©talos mÃ¡s largos y sÃ©palos ligeramente mÃ¡s grandes. El ratio `Sepalo_Ratio` destaca diferencias morfolÃ³gicas entre especies.

## 2.4Â Visualizaciones clave
```{r plots, warning=FALSE}
# Histograma interactivo del largo del pÃ©talo
plotly::ggplotly(
  ggplot(iris_clean, aes(Petalo_Largo_cm, fill = Species)) +
    geom_histogram(alpha = 0.7, bins = 20, colour = "black") +
    theme_minimal() +
    labs(title = "DistribuciÃ³n del largo del pÃ©talo", x = "cm")
)

```

---
# 3ï¸âƒ£Â Tests de hipÃ³tesis ğŸ§ª

## 3.1Â Â¿La media de `Sepal_Length` en *versicolor* es 6â€¯cm?
```{r t-one-sample-iris}
versicolor <- filter(iris_clean, Species == "versicolor")

t.test(versicolor$Sepal_Length, mu = 6)
```

El pâ€‘valorâ€¯â‰ˆâ€¯0.38 indica que no hay evidencia estadÃ­stica para afirmar que la longitud media del sÃ©palo en versicolor sea distinta de 6â€¯cm.
La media muestral es 5.94â€¯cm y el intervaloâ€¯95â€¯% (5.79â€¯â€“â€¯6.08â€¯cm) contiene al 6, por eso no se rechaza la hipÃ³tesis nula.

*Hâ‚€*: Î¼ = 6Â cm.  

## 3.2Â Â¿`virginica` tiene pÃ©talos mÃ¡s largos que `versicolor`? (Welch)
```{r welch-iris}
virginica <- filter(iris_clean, Species == "virginica")

t.test(virginica$Petalo_Largo_cm, versicolor$Petalo_Largo_cm,
       alternative = "greater", var.equal = FALSE)
```
El test Welch t compara las medias de dos grupos sin asumir varianzas iguales.
AquÃ­ el pâ€‘valorâ€¯<â€¯2.2â€¯Ã—â€¯10â»Â¹â¶ â‡’ virginica tiene pÃ©talos significativamente mÃ¡s largos que versicolor.
La diferencia estimada es 5.55â€¯cmâ€¯âˆ’â€¯4.26â€¯cmâ€¯â‰ˆâ€¯1.29â€¯cm; con 95â€¯% de confianza es >â€¯1.12â€¯cm.
En suma, rechazamos Hâ‚€ / greater es una prueba unilateral



## 3.3Â Test de proporciones (moneda imaginaria) / Ese es un test de proporciÃ³n para una sola muestra (1â€‘sample proportion test). Su finalidad:

Comprobar si la proporciÃ³n realâ€‘poblacionalâ€¯(p) de un suceso (caras) coincide con un valor especÃ­fico pâ‚€ (aquÃ­â€¯0.5).


```{r prop-test}
caras <- 530; n <- 1000
prop.test(caras, n, p = 0.5, correct = FALSE)
```

Este test comprueba si la proporciÃ³n real de carasâ€¯(p) difiere deâ€¯0.5.
El pâ€‘valorâ€¯â‰ˆâ€¯0.058 (>â€¯0.05) indica insuficiente evidencia para decir que la moneda estÃ© sesgada; la diferencia observada (53â€¯%) puede ser azar.
El intervaloâ€¯95â€¯% (0.499â€“0.561) incluye 0.5, reforzando que no se rechaza Hâ‚€ de â€œmoneda justaâ€.





